#!/bin/bash
# SPDX-License-Identifier: Apache-2.0
# Copyright (C) 2021-present Fewtarius (https://github.com/fewtarius)

. /etc/profile

cat <<EOF >/storage/.config/profile.d/006-hdmi
HDMI=\$(modetest 2>/dev/null | awk '/HDMI-/ {print \$3}')
ROTATED=\$(</sys/devices/virtual/graphics/fbcon/rotate)
if [ ! "\${HDMI}" = "connected" ] && \
   [ "\${ROTATED}" = "3" ]
then
  SDL=\$(readlink -f /usr/lib/SDL2-rotated/libSDL2.so 2>/dev/null)
  export LD_PRELOAD="\${SDL}"
fi
EOF

chmod 0755 /storage/.config/profile.d/006-hdmi
